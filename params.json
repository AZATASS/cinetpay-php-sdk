{
  "name": "Cinetpay-php-sdk",
  "tagline": "CinetPay SDK PHP Integration permet d'intégrer rapidement CinetPay à un site en ligne fait avec PHP.",
  "body": "#CinetPay SDK PHP Integration\r\n\r\nCinetPay SDK PHP Integration permet d'intégrer rapidement CinetPay à un site en ligne fait avec PHP.\r\n\r\nL'intégration de ce SDK se fait en deux etapes :\r\n\r\n##Etape 1 : Préparation des pages de notification, de retour et d'annulation\r\n\r\n###Page de Notification\r\nPour ceux qui possèdent des services qui ne neccessitent pas un traitement des notifications de paiement de CinetPay, vous pouvez passer directement à la phase suivante, par exemple les services de don.\r\n\r\nA chaque paiement, CinetPay vous notifie via un lien de notification.\r\n\r\nNB :\r\n\r\n    -C'est un lien silencieux\r\n    -C'est le seul lien qui est abilité à mettre à jour les informations de la bd relatif à la transaction\r\n\r\nExemple :\r\n```php \r\n<?php\r\nif (isset($_POST['cpm_trans_id'])) {\r\n    // SDK PHP de CinetPay \r\n    require_once __DIR__ . '/cinetpay.php';\r\n    require_once __DIR__ . '/commande.php';\r\n\r\n    //La classe commande correspond à votre colonne qui gère les transactions dans votre base de données\r\n    $commande = new Commande();\r\n    try {\r\n        // Initialisation de CinetPay et Identification du paiement\r\n        $id_transaction = $_POST['cpm_trans_id'];\r\n        $apiKey = _VOTRE_APIKEY_;\r\n        $site_id = _VOTRE_SITEID_;\r\n        $plateform = \"TEST\"; // Valorisé à PROD si vous êtes en production\r\n        $CinetPay = new CinetPay($site_id, $apiKey, $plateform);\r\n        // Reprise exacte des bonnes données chez CinetPay\r\n        $CinetPay->setTransId($id_transaction)->getPayStatus();\r\n        $cpm_site_id = $CinetPay->_cpm_site_id;\r\n        $signature = $CinetPay->_signature;\r\n        $cpm_amount = $CinetPay->_cpm_amount;\r\n        $cpm_trans_id = $CinetPay->_cpm_trans_id;\r\n        $cpm_custom = $CinetPay->_cpm_custom;\r\n        $cpm_currency = $CinetPay->_cpm_currency;\r\n        $cpm_payid = $CinetPay->_cpm_payid;\r\n        $cpm_payment_date = $CinetPay->_cpm_payment_date;\r\n        $cpm_payment_time = $CinetPay->_cpm_payment_time;\r\n        $cpm_error_message = $CinetPay->_cpm_error_message;\r\n        $payment_method = $CinetPay->_payment_method;\r\n        $cpm_phone_prefixe = $CinetPay->_cpm_phone_prefixe;\r\n        $cel_phone_num = $CinetPay->_cel_phone_num;\r\n        $cpm_ipn_ack = $CinetPay->_cpm_ipn_ack;\r\n        $created_at = $CinetPay->_created_at;\r\n        $updated_at = $CinetPay->_updated_at;\r\n        $cpm_result = $CinetPay->_cpm_result;\r\n        $cpm_trans_status = $CinetPay->_cpm_trans_status;\r\n        $cpm_designation = $CinetPay->_cpm_designation;\r\n        $buyer_name = $CinetPay->_buyer_name;\r\n\r\n        // Recuperation de la ligne de la transaction dans votre base de données\r\n        $commande->setTransId($id_transaction);\r\n        $commande->getCommandeByTransId();\r\n        // Verification de l'etat du traitement de la commande\r\n        if ($commande->getStatut() == '00') {\r\n            // La commande a été déjà traité\r\n            // Arret du script\r\n            die();\r\n        }\r\n        // Dans le cas contrait, on remplit notre ligne des nouvelles données acquise en cas de tentative de paiement sur CinetPay\r\n        $commande->setMethode($payment_method);\r\n        $commande->setPayId($cpm_payid);\r\n        $commande->setBuyerName($buyer_name);\r\n        $commande->setSignature($signature);\r\n        $commande->setPhone($cel_phone_num);\r\n        $commande->setDatePaiement($cpm_payment_date . ' ' . $cpm_payment_time);\r\n\r\n        // On verifie que le montant payé chez CinetPay correspond à notre montant en base de données pour cette transaction\r\n        if ($commande->getMontant() == $cpm_amount) {\r\n            // C'est OK : On continue le remplissage des nouvelles données\r\n            $commande->setErrorMessage($cpm_error_message);\r\n            $commande->setStatut($cpm_result);\r\n            $commande->setTransStatus($cpm_trans_status);\r\n            if($cpm_result == '00'){\r\n                //Le paiement est bon\r\n                // Traitez et delivrez le service au client\r\n            }else{\r\n                //Le paiement a échoué\r\n            }\r\n        } else {\r\n            //Fraude : montant payé ' . $cpm_amount . ' ne correspond pas au montant de la commande\r\n            $commande->setStatut('-1');\r\n            $commande->setTransStatus('REFUSED');\r\n        }\r\n        // On met à jour notre ligne\r\n        $commande->update();\r\n    } catch (Exception $e) {\r\n        echo \"Erreur :\" . $e->getMessage();\r\n        // Une erreur s'est produite\r\n    }\r\n} else {\r\n    // Tentative d'accès direct au lien IPN\r\n}\r\n?>\r\n```\r\n###Page de Retour\r\n\r\nLa page de retour est la page où est redirigé le client après une transaction sur CinetPay (quelque soit le status de la transaction). Aucune mise à jour de la base de données ne doit être traiter si cette page\r\n\r\nExemple de page de retour :\r\n```php\r\n<?php\r\nif (isset($_POST['cpm_trans_id'])) {\r\n    // SDK PHP de CinetPay \r\n    require_once __DIR__ . '/cinetpay.php';\r\n    require_once __DIR__ . '/commande.php';\r\n\r\n    //La classe commande correspond à votre colonne qui gère les transactions dans votre base de données\r\n    $commande = new Commande();\r\n    try {\r\n        // Initialisation de CinetPay et Identification du paiement\r\n        $id_transaction = $_POST['cpm_trans_id'];\r\n        $apiKey = _VOTRE_APIKEY_;\r\n        $site_id = _VOTRE_SITEID_;\r\n        $plateform = \"TEST\"; // Valorisé à PROD si vous êtes en production\r\n        $CinetPay = new CinetPay($site_id, $apiKey, $plateform);\r\n        // Reprise exacte des bonnes données chez CinetPay\r\n        $CinetPay->setTransId($id_transaction)->getPayStatus();\r\n        $cpm_site_id = $CinetPay->_cpm_site_id;\r\n        $signature = $CinetPay->_signature;\r\n        $cpm_amount = $CinetPay->_cpm_amount;\r\n        $cpm_trans_id = $CinetPay->_cpm_trans_id;\r\n        $cpm_custom = $CinetPay->_cpm_custom;\r\n        $cpm_currency = $CinetPay->_cpm_currency;\r\n        $cpm_payid = $CinetPay->_cpm_payid;\r\n        $cpm_payment_date = $CinetPay->_cpm_payment_date;\r\n        $cpm_payment_time = $CinetPay->_cpm_payment_time;\r\n        $cpm_error_message = $CinetPay->_cpm_error_message;\r\n        $payment_method = $CinetPay->_payment_method;\r\n        $cpm_phone_prefixe = $CinetPay->_cpm_phone_prefixe;\r\n        $cel_phone_num = $CinetPay->_cel_phone_num;\r\n        $cpm_ipn_ack = $CinetPay->_cpm_ipn_ack;\r\n        $created_at = $CinetPay->_created_at;\r\n        $updated_at = $CinetPay->_updated_at;\r\n        $cpm_result = $CinetPay->_cpm_result;\r\n        $cpm_trans_status = $CinetPay->_cpm_trans_status;\r\n        $cpm_designation = $CinetPay->_cpm_designation;\r\n        $buyer_name = $CinetPay->_buyer_name;\r\n\r\n        // Recuperation de la ligne de la transaction dans votre base de données\r\n        $commande->setTransId($id_transaction);\r\n        $commande->getCommandeByTransId();\r\n        // Verification de l'etat du traitement de la commande\r\n        if ($commande->getStatut() == '00') {\r\n            echo 'Felicitation, votre paiement a été effectué avec succès';\r\n            die();\r\n        }\r\n        // On verifie que le montant payé chez CinetPay correspond à notre montant en base de données pour cette transaction\r\n        if ($commande->getMontant() == $cpm_amount) {\r\n            if($cpm_result == '00'){\r\n                 echo 'Felicitation, votre paiement a été effectué avec succès';\r\n                 die();\r\n            }else{\r\n                echo 'Echec, votre paiement a échoué';\r\n                die();\r\n            }\r\n        } else {\r\n             echo 'Echec, votre paiement a été validé mais les montants ne correspondent pas';\r\n             die();\r\n        }\r\n    } catch (Exception $e) {\r\n        echo \"Erreur :\" . $e->getMessage();\r\n        // Une erreur s'est produite\r\n    }\r\n} else {\r\n   // redirection vers la page d'accueil\r\n    die();\r\n}\r\n?>\r\n```\r\n\r\n###Page d'Annulation\r\n\r\nEn depit de faire une page d'annulation, vous pouvez simplement utiliser votre page d'accueil\r\n\r\n##Etape 2 : Préparation et affichage du formulaire de paiement\r\n\r\nLe formulaire de paiement CinetPay est constitué de :\r\n\r\n    transId : L'identifiant de la transaction\r\n    designation :  La designation de la transaction\r\n    transDate : La date du debut de la transaction\r\n    amount : Le montant de la transaction\r\n    version : La version à utiliser\r\n    custom : La valeur qui vou permettra d'identifier de façon unique la personne effectuant la transaction dans votre système\r\n    notifyUrl : Url silencieuse que CinetPay appel après chaque transaction, peut être appelé plusieurs fois\r\n    returnUrl : Après une transaction, c'est le lien où est redirigé le client\r\n    cancelUrl : Le lien appelé quand le client annule volontairement sa transaction\r\n    \r\nPour plus de sécurité, Il faut enregistrer les informations sur le paiement dans la base de données avant d'afficher le formulaire.\r\n\r\nExemple :\r\n```php\r\n<?php\r\n        // Inclusion des classes necessaires\r\n        require_once __DIR__ . '/cinetpay.php';\r\n        require_once __DIR__ . '/commande.php';\r\n        $commande = new Commande();\r\n        try {\r\n            $id_transaction = date(\"YmdHis\"); // ou $id_transaction = Cinetpay::generateTransId()\r\n            $description_du_paiement = \"Mon produit de ref: $id_transaction\";\r\n            $date_transaction = date(\"Y-m-d H:i:s\");\r\n            // Montant minimun est de 5 francs sur CinetPay\r\n            $montant_a_payer = mt_rand(5, 100);\r\n            \r\n            // Mettez ici une information qui vous permettra d'identifier de façon unique le payeur\r\n            $identifiant_du_payeur = 'payeur@domaine.ci';\r\n            \r\n            //Veuillez entrer votre apiKey\r\n            $apiKey = \"39955468c7a8c0cef1.68322505\";\r\n            //Veuillez entrer votre siteId\r\n            $site_id = \"485179\";\r\n            \r\n            //platform ,  utiliser PROD si vous avez créé votre compte sur www.cinetpay.com  ou TEST si vous avez créé votre compte sur www.sandbox.cinetpay.com\r\n            $plateform = \"TEST\";\r\n            \r\n            //la version ,  utiliser V1 si vous avez créé votre compte sur www.cinetpay.com  ou V2 si vous avez créé votre compte sur www.sandbox.cinetpay.com\r\n            $plateform = \"V2\";\r\n    \r\n            // nom du formulaire CinetPay\r\n            $formName = \"goCinetPay\";\r\n            // Les liens CinetPay\r\n            $notify_url = '';\r\n            $return_url = '';\r\n            $cancel_url = '';\r\n            // Configuration du bouton\r\n            $btnType = 2;//1-5\r\n            $btnWidth = \"120px\";\r\n            $btnHeight = \"\";\r\n    \r\n            // Enregistrement de la commande dans notre BD\r\n            $commande->setTransId($id_transaction);\r\n            $commande->setMontant($montant_a_payer);\r\n            $commande->create();\r\n            \r\n            // Paramétrage du panier CinetPay et affichage du formulaire\r\n            $CinetPay = new CinetPay($site_id, $apiKey, $plateform);\r\n            $CinetPay->setTransId($id_transaction)\r\n                    ->setDesignation($description_du_paiement)\r\n                    ->setTransDate($date_transaction)\r\n                    ->setAmount($montant_a_payer)\r\n                    ->setVersion($version)\r\n                    ->setCustom($identifiant_du_payeur)// optional\r\n                    ->setNotifyUrl($notify_url)// optional\r\n                    ->setReturnUrl($return_url)// optional\r\n                    ->setCancelUrl($cancel_url)// optional\r\n                    ->displayPayButton($formName, $btnType, $btnWidth, $btnHeight);\r\n        } catch (Exception $e) {\r\n            // Une erreur est survenue\r\n            echo $e->getMessage();\r\n        }\r\n?>\r\n```\r\nVotre Api Key et Site ID\r\n\r\nCes informations sont disponibles dans votre BackOffice CinetPay.\r\n\r\nExemple Intégration\r\n\r\nVous trouverez un exemple d'intégration complet dans le dossier exemple/",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}